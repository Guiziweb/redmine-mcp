#!/bin/bash
# Pre-commit hook for MCP Redmine
# Uses Makefile for quality checks

set -e

echo "ğŸ” Pre-commit checks using Makefile..."

# Check if Makefile exists
if [ ! -f "Makefile" ]; then
    echo "âŒ Makefile not found."
    exit 1
fi

# Check if vendor exists
if [ ! -d "vendor" ]; then
    echo "âŒ vendor/ directory not found. Run 'make install-dev' first."
    exit 1
fi

echo "ğŸ”§ Running quality checks..."
if ! make static-analysis; then
    echo "âŒ Quality checks failed. Run 'make cs-fix' to fix style issues."
    exit 1
fi

echo "ğŸ§ª Running tests..."
if ! make test; then
    echo "âŒ Tests failed. Fix them before committing."
    exit 1
fi

echo "âœ… All checks passed! Proceeding with commit..."