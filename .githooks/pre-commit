#!/bin/bash
# Pre-commit hook for MCP Redmine
# Uses Makefile for quality checks

set -e

echo "🔍 Pre-commit checks using Makefile..."

# Check if Makefile exists
if [ ! -f "Makefile" ]; then
    echo "❌ Makefile not found."
    exit 1
fi

# Check if vendor exists
if [ ! -d "vendor" ]; then
    echo "❌ vendor/ directory not found. Run 'make install-dev' first."
    exit 1
fi

echo "🔧 Running quality checks..."
if ! make static-analysis; then
    echo "❌ Quality checks failed. Run 'make cs-fix' to fix style issues."
    exit 1
fi

echo "🧪 Running tests..."
if ! make test; then
    echo "❌ Tests failed. Fix them before committing."
    exit 1
fi

echo "✅ All checks passed! Proceeding with commit..."